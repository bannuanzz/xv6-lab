# 系统调用

1. 修改makefile文件 添加u/_getprocs u_memTest    作为用户的目标文件，即编译后的可执行文件
2. 在defs.h 文件里 proc添加getprocs  在kalloc里添加memTest
3. 在 proc里添加 getprocs函数  在kalloc里添加对应的memTest相关函数 
4. 改变syscall 文件里的内容 在.h里面添加宏定义 和在.c文件里添加系统调用号和处理函数的映射关系 trapframe中获取系统调用号存到 a0寄存器中
5. 在sysproc.c里添加对应的系统调用的接口 两个
6. 在user.h里添加对应的函数名，并在user文件里写出对应的函数实现
7. usys.pl 文件通常用于生成系统调用的汇编代码，它的作用是将系统调用的声明转换为汇编语言代码。 在usys.pl里添加系统调用的接口







# 内核动态内存分配

1. 先从memlayout中最顶端的地址扣除8MB  需要在kvmmap里完成虚拟地址与物理地址的直接映射 xv6是三级页表

2. 初始化内存写minit 与kinit不同 128MB可以分成很多4KB而 动态分配内存只有一大块所以只用初始化一次   注意minit在主函数的位置 

3. 单链表循环遍历freelist的个数

4. 合并空闲内存块， 注意合并方法，如果这个内存的首地址加上它的大小等于下一块空闲内存的首地址就合并，可能下下块也是空闲的所以要用continue

5. free 首次适应算法要按照地址递增顺序 排列空闲块  

6. 分配内存块，不能完全分配，要给指针留位置

7. 注意所有的kalloc 里面的都不能直接创建变量，因为没人给他分配

   